# 为Calico组件配置加密和认证机制

## 从Calico组件到etcd的连接

如果你使用了etcd数据存储，我们建议开启它的双向TLS认证。

- [配置etcd](https://etcd.io/)使用TLS对通信进行加密，并且要求客户端出示由etcd签名的证书。
- 配置每个Calico组件验证etcd服务器的身份，并且向etcd服务器出示由etcd签名的证书。
    - [calico/node](../../06%E5%8F%82%E8%80%83/06calico-node.md)
    - [`calicoctl`](../../05%E8%BF%90%E7%BB%B4/02calicoctl/02%E9%85%8D%E7%BD%AEcalicoctl/02%E9%85%8D%E7%BD%AEcalicoctl%E8%BF%9E%E6%8E%A5%E5%88%B0etcd%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8.md)
    - [CNI插件](../../06%E5%8F%82%E8%80%83/10Calico%20CNI%E6%8F%92%E4%BB%B6.md#etcd的位置)（仅限Kubernetes和OpenShift）
    - [Kubernetes controllers](../../06%E5%8F%82%E8%80%83/11Calico%E7%9A%84Kubernets%E6%8E%A7%E5%88%B6%E5%99%A8.md#配置数据存储的访问)（仅限Kubernetes和OpenShift）
    - [Felix](../../06%E5%8F%82%E8%80%83/07Felix/01%E9%85%8D%E7%BD%AE.md#etcd数据存储配置)
    - [Typha](../../06%E5%8F%82%E8%80%83/08Typha/02%E9%85%8D%E7%BD%AE.md#etcd数据存储配置)（通常部署于较大的Kubernetes环境中）
    - [Neutron插件或ML2驱动]()（仅限OpenStack，略）
    - [DHCP代理]()（仅限OpenStack，略）

### 从Calico组件到kube-apiserver的连接（Kubernetes和OpenShift）

我们建议开启kube-apiserver的TLS，以及客户端证书和JSON web token（JWT）认证模块。这样可以确保它跟Calico组件的所有通信都是建立在TLS上的。Calico组件可以提供一个X.509证书或一个JWT，便于kube-apiserver验证它的身份。

### 从Felix到Typha的连接（Kubernetes）

我们建议为Felix到Typha的连接启用双向TLS认证。此时你必须给Typha创建一个服务端证书，给Felix创建一个客户端证书。每个服务都需要证书对应的私钥。此外，你必须配置以下几项之一。

- **SPIFFE标识符**（推荐）：为Felix生成一个[SPIFFE](https://github.com/spiffe/spiffe)标识符，将Typha的`ClientURISAN`设置成Felix的SPIFFE ID，并且在它的证书中包含Felix的SPIFFE ID。